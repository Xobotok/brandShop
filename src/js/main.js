"use strict";var _createClass=function(){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Dropdown=function(){function n(t,e,i,s){_classCallCheck(this,n),this.element=document.getElementById(t),this.dropmenu=document.getElementById(e),this.dropmenuLinks=document.getElementsByClassName(i),this.caretElement=document.getElementById(s),this.element.addEventListener("click",this.dropped.bind(this));for(var a=0;a<this.dropmenuLinks.length;a++)this.dropmenuLinks[a].addEventListener("click",this.changeTitle.bind(this))}return _createClass(n,[{key:"dropped",value:function(){var t=window.getComputedStyle(this.dropmenu).visibility;"hidden"===t||""===t?(this.dropmenu.classList.remove("invisible"),this.dropmenu.classList.add("visible")):(this.dropmenu.classList.remove("visible"),this.dropmenu.classList.add("invisible"))}},{key:"changeTitle",value:function(){var t=event.target.textContent;this.element.textContent=t,this.caretElement&&this.element.appendChild(this.caretElement),this.dropmenu.classList.remove("visible"),this.dropmenu.classList.add("invisible")}}]),n}(),DropBasketItem=function t(e){_classCallCheck(this,t),this.id=e.id,this.title=e.title,this.rating=e.rating,this.price=e.price,this.img=e.img,this.count=1},Basket=function(){function t(){_classCallCheck(this,t),this.dropDownCart=new Dropdown("header__cart","basket__drop"),this.element=document.getElementById("basket__drop"),this.items=[],(this.totalPrice=0)<localStorage.length&&(this.items=JSON.parse(localStorage.getItem("basket"))),this.basketDropRender(this),console.log(this.items)}return _createClass(t,[{key:"refreshTotalPrice",value:function(){for(var t=this.totalPrice=0;t<this.items.length;t++)this.totalPrice+=this.items[t].price}},{key:"addItem",value:function(t){this.items.push(t),localStorage.setItem("basket",JSON.stringify(this.items)),this.refreshTotalPrice(),this.basketDropRender(this)}},{key:"removeItem",value:function(t){for(var e=0;e<this.items.length;e++){if(t===this.items[e]){this.items.splice(e,1),e--;break}if(t instanceof DropBasketItem){if(this.items[e].id===t.id&&1===parseInt(this.items[e].count)){this.items.splice(e,1),e--;break}if(this.items[e].id===t.id&&1<this.items[e].count){this.items[e].count--;break}}}console.log(this.items),localStorage.setItem("basket",JSON.stringify(this.items)),this.refreshTotalPrice(),this.basketDropRender(this)}},{key:"clearBasket",value:function(){this.items=[],localStorage.setItem("basket",JSON.stringify(this.items)),this.refreshTotalPrice(),this.basketDropRender(this)}},{key:"basketDropRender",value:function(h){var u=this,m=h;this.removeAll(),this.items.length<1?(this.noItems=document.createElement("h4"),this.noItems.className="noItems",this.noItems.setAttribute("id","noItems"),this.noItems.textContent="No items in a cart",this.element.appendChild(this.noItems)):function(){u.totalPrice=0;for(var o=[],t=0;t<h.items.length;t++){if(1<h.items[t].count)for(var e=1;e<h.items[t].count;e++)o.push(new DropBasketItem(u.items[t]));o.push(new DropBasketItem(u.items[t]))}for(var i=0;i<o.length;i++)for(var s=i+1;s<o.length;s++)o[i].id===o[s].id&&(o[i].count++,o.splice(s,1),s--);u.renderItems=o;for(var a=function(t){u.totalPrice+=o[t].price*o[t].count;var e=$("<div />",{class:"basket__item"});e.appendTo(u.element),$("<img />",{class:"basket__item_img",src:o[t].img}).appendTo(e),$("<p />",{class:"basket__item_title",text:o[t].title}).appendTo(e);var i=$("<div />",{class:"stars"});i.appendTo(e);for(var s=0;s<5;s++){if(.5<o[t].rating-s)$("<i class='fa fa-star star fullstar'></i>").appendTo(i);else if(o[t].rating-s==.5){$("<i class='fa fa-star-half-o star halfstar'></i>").appendTo(i)}else{$("<i class='fa fa-star-o star emptystar'></i>").appendTo(i)}}var a=$("<div />",{class:"basket__item_price"});a.appendTo(e),$("<p />",{class:"price",text:o[t].count+" x $"+o[t].price}).appendTo(a);var n=$("<button class = \"basket__item_delete\"><i class = 'fa fa-times-circle'></i></button>",{});n.on("click",function(){m.removeItem(o[t]),m.basketDropRender(h),m.bigBasketRender(h)}),n.appendTo(e)},n=0;n<o.length;n++)a(n);var r=document.createElement("div"),l=document.createElement("p");r.className="total",l.classList.add("total__title"),l.textContent="total",r.appendChild(l);var c=document.createElement("p");c.classList.add("total__price"),c.textContent="$"+u.totalPrice.toFixed(2),r.appendChild(c),u.element.appendChild(r),$("<a />",{class:"basket__drop_checkout",text:"checkout",href:"#"}).appendTo(u.element),$("<a />",{class:"basket__drop_gotocart",text:"go to cart",href:"shoppingcart.html"}).appendTo(u.element);for(var d=0,p=0;p<u.items.length;p++)d+=parseInt(u.items[p].count);$("<p />",{class:"basket__drop_count",text:d,id:"header__cart_count"}).appendTo($("#header__cart"))}()}},{key:"bigBasketRender",value:function(){var m=this,v=this.items;if($("#cont").empty(),this.items<1){var t=$("<div />",{class:"emptybasket__container"});t.appendTo($("#cont")),$("<h3 />",{class:"emptybasket__container_title",text:"No items in a cart"}).appendTo(t)}for(var e=function(i){""===v[i].count&&(v[i].count=1);var t=$("<div />",{class:"product__item"});t.appendTo($("#cont"));var e=$("<div />");e.appendTo(t),$("<img />",{class:"product__item_img",src:v[i].img,alt:v[i].title.toUpperCase()}).appendTo(e),$("<h5 />",{class:"product__item_title",text:v[i].title}).appendTo(e);var s=$("<button />",{class:"product__item_color",text:"Color: "+v[i].actualColor[0].toUpperCase()+v[i].actualColor.substring(1)});s.appendTo(e);var a=$("<ul />",{class:"color__drop",id:"color"+v[i].id+i});a.appendTo(e),s.on("click",function(){$("#size"+v[i].id+i).hide(500),$("#color"+v[i].id+i).toggle(500)});for(var n=function(t){var e=$("<li/>",{text:v[i].color[t][0].toUpperCase()+v[i].color[t].substring(1)});e.appendTo(a),e.on("click",function(){s.text("Color: "+e.text()),v[i].actualColor=event.target.textContent,localStorage.setItem("basket",JSON.stringify(m.items)),a.hide(500)})},o=0;o<v[i].color.length;o++)n(o);var r=$("<button />",{class:"product__item_size",text:"Size: "+v[i].actualSize.toUpperCase()}),l=$("<ul />",{class:"size__drop",id:"size"+v[i].id+i});r.appendTo(e),r.on("click",function(){$("#size"+v[i].id+i).toggle(500),$("#color"+v[i].id+i).hide(500)}),l.appendTo(e);for(var c=function(t){var e=$("<li />",{text:v[i].size[t].toUpperCase(),id:v[i].id+v[i].size[t].toUpperCase()});e.on("click",function(){r.text("Size: "+e.text()),v[i].actualSize=event.target.textContent,localStorage.setItem("basket",JSON.stringify(m.items)),console.log(v),a.hide(500),l.hide(500)}),e.appendTo(l)},d=0;d<v[i].size.length;d++)c(d);$("<p />",{class:"product__item_currentprice",text:"$"+v[i].price.toFixed(2)}).appendTo(t);var p=$("<input>",{type:"text",value:v[i].count,class:"product__item_quantity"});p.appendTo(t),$("<p />",{class:"product__item_shipping",text:"FREE"}).appendTo(t);var h=$("<p />",{class:"product__item_subtotal",text:"$"+(v[i].price*v[i].count).toFixed(2)});h.appendTo(t),p.on("input",function(t){/\D/.exec($(t.target).val())?(this.value=v[i].count,h.text("$"+(v[i].count*v[i].price).toFixed(2)),console.log("Регулярка не работает")):(0===parseInt(this.value)&&(this.value=1,v[i].count=this.value()),$(t.target).val()<99?(v[i].count=$(t.target).val(),this.value=v[i].count,h.text("$"+(v[i].count*v[i].price).toFixed(2)),localStorage.setItem("basket",JSON.stringify(v))):($(t.target).val(99),v[i].count=this.value()),m.basketDropRender(m))}),p.blur(function(){""===this.value&&(this.value=1,v[i].count=parseInt(this.value),m.basketDropRender(m),m.bigBasketRender())});var u=$('<p class="product__item_action"><i class="fa fa-times-circle" aria-hidden="true"></i></p>');u.appendTo(t),u.on("click",function(){m.removeItem(v[i]),m.bigBasketRender(),m.basketDropRender(m)})},i=0;i<v.length;i++)e(i);var s=$("<div />",{class:"product__itembuttons"});s.appendTo($("#cont"));var a=$("<button />",{class:"product__itembuttons_button",text:"clear shopping cart"});a.appendTo(s),a.on("click",function(){m.clearBasket(),m.basketDropRender(m),m.bigBasketRender()}),$("<a />",{class:"product__itembuttons_button",text:"continue shopping",href:"product.html"}).appendTo(s)}},{key:"removeAll",value:function(){for(;this.dropDownCart.dropmenu.firstChild;){this.dropDownCart.dropmenu.removeChild(this.dropDownCart.dropmenu.firstChild),$("#header__cart_count").remove()}}}]),t}(),Navigation=function(){function e(t){_classCallCheck(this,e),this.json=t,this.jsonMenu=this.render(this.json)}return _createClass(e,[{key:"render",value:function(t){for(var e=JSON.parse(t).menu,i=document.getElementById("header__navigation"),s=0;s<e.length;s++){var a=document.createElement("ul");a.classList.add(e[s].class),a.setAttribute("id",e[s].id);var n=document.createElement("a");n.setAttribute("href",e[s].href),n.classList.add("navigation__link"),n.textContent=e[s].content,n.setAttribute("href",e[s].href),a.appendChild(n);var o=document.createElement("div");if(o.classList.add("dropdown"),i.appendChild(a),0<e[s].tabs.length)for(var r=0;r<e[s].tabs.length;r++)if(e[s].tabs[r].object){var l=document.createElement("ul"),c=document.createElement("li");c.textContent=e[s].tabs[r].object,l.appendChild(c),o.appendChild(l),a.appendChild(o);for(var d=0;d<e[s].tabs[r].tabs.length;d++)if("image"!==e[s].tabs[r].tabs[d].name){var p=document.createElement("a");p.textContent=e[s].tabs[r].tabs[d].name,p.setAttribute("href",e[s].tabs[r].tabs[d].href),l.appendChild(p)}else{var h=document.createElement("a");h.setAttribute("href",e[s].tabs[r].tabs[d].href);var u=document.createElement("img");u.setAttribute("src",e[s].tabs[r].tabs[d].src),u.setAttribute("alt",e[s].tabs[r].tabs[d].alt),h.appendChild(u),l.appendChild(h)}}else{var m=document.createElement("ul"),v=document.createElement("li"),f=document.createElement("a");f.setAttribute("href",e[s].tabs[r].href),f.textContent=e[s].tabs[r].name,v.appendChild(f),m.appendChild(v),o.appendChild(m),a.appendChild(o)}}}}]),e}();function jsonNavigationRequest(t){var e=new XMLHttpRequest,i="";e.onreadystatechange=function(){4===e.readyState&&200===e.status&&(i=e.responseText,new Navigation(i))},e.open("GET",t),e.send()}function getRandomItems(t,e){for(var i=t,s=e,a=[],n=0;n<s;n++){var o=Math.floor(Math.random()*i.length);a.push(i[o]),i.splice(o,1)}return a}var Item=function t(e,i,s,a,n,o,r,l,c,d,p,h,u){_classCallCheck(this,t),this.id=e,this.title=i,this.description=s,this.img=a,this.link=n,this.price=o,this.rating=r,this.designer=l,this.material=c,this.brand=d,this.category=p,this.color=h,this.size=u,this.count=1,this.actualColor=this.color[0][0].toUpperCase()+this.color[0].substring(1).toLowerCase(),this.actualSize=this.size[0].toUpperCase()},SlideItem=function t(e,i,s,a,n,o){_classCallCheck(this,t),this.id=e,this.img=i,this.alt=s,this.text=a,this.signature=n,this.town=o,this.button=""},Slider=function(){function t(){_classCallCheck(this,t);this.jsonRequest(this),this.items=[],this.slider=$("#slider")[0],this.activeSlide="",this.timer=1e4}return _createClass(t,[{key:"jsonRequest",value:function(i){$.get({url:"./js/JSON/slider.json",dataType:"json",success:function(t){var e=t.items;i.initialize(i,e)}})}},{key:"initialize",value:function(t,e){this.items=[];for(var i=0;i<e.length;i++){var s=new SlideItem(e[i].id,e[i].img,e[i].alt,e[i].text,e[i].signature,e[i].town);this.items.push(s)}this.render(this,this.items)}},{key:"render",value:function(s,t){for(var a=t,n=$("#slider"),o=$("<div />",{class:"slider__buttons"}),e=function(t){var e=$("<div />",{class:"slider__slide invisible",id:a[t].id});e.appendTo(n),$("<img />",{class:"slider__slide_img",src:a[t].img,alt:a[t].alt}).appendTo(e),$("<p />",{class:"slider__slide_text",text:a[t].text}).appendTo(e),$("<p />",{class:"slider__slide_signature",text:a[t].signature}).appendTo(e),$("<p />",{class:"slider__slide_town",text:a[t].town}).appendTo(e);var i=$("<button />",{class:"slider__slide_activate",id:"button"+a[t].id});a[t].button="button"+a[t].id,i.appendTo(o),i.on("click",function(){s.activateSlide(a[t].button)})},i=0;i<a.length;i++)e(i);o.appendTo(n);var r=this.items[Math.floor(4*Math.random())].id;document.getElementById(r).classList.add("visible"),$("#button"+r).toggleClass("active")}},{key:"activateSlide",value:function(t){for(var e=0;e<this.items.length;e++)t==="button"+this.items[e].id?($("#"+this.items[e].id)[0].classList.add("visible"),$("#button"+this.items[e].id)[0].classList.add("active")):($("#"+this.items[e].id)[0].classList.remove("visible"),$("#button"+this.items[e].id)[0].classList.remove("active"))}}]),t}();